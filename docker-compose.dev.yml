services:
  landing:
    build:
      context: .
      dockerfile: apps/landing/Dockerfile
      target: deps           # only installs deps, no build
    command: sh -c "cd /repo/apps/landing && npx next dev --port 3000"
    ports:
      - "3000:3000"
    environment:
      NODE_ENV: development
    volumes:
      - ./apps/landing:/repo/apps/landing
      - ./packages:/repo/packages
      - landing_nm:/repo/node_modules   # preserve container's node_modules

  app:
    build:
      context: .
      dockerfile: apps/app/Dockerfile
      target: deps           # only installs deps, no build
    command: sh -c "cd /repo/apps/app && npx next dev --port 3001"
    ports:
      - "3001:3001"
    environment:
      NODE_ENV: development
    volumes:
      - ./apps/app:/repo/apps/app
      - ./packages:/repo/packages
      - app_nm:/repo/node_modules       # preserve container's node_modules

  ws:
    build:
      context: .
      dockerfile: services/ws-server/Dockerfile
      target: deps
    command: sh -c "npx ts-node-dev --respawn --transpile-only src/index.ts"
    ports:
      - "3002:3002"
    environment:
      NODE_ENV: development
      PORT: 3002
    volumes:
      - ./services/ws-server/src:/app/src

volumes:
  landing_nm:
  app_nm:
